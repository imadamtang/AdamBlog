<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Maverick,blog" />
    <meta name="generator" content="Maverick 1.2.1" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="一博客 &raquo; RSS 2.0" href="https://blog.imadamtang.cn/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="一博客 &raquo; ATOM 1.0" href="https://blog.imadamtang.cn/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/galileo-8d8763e752.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/ExSearch/ExSearch-182e5a8868.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/katex.min.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700&display=swap">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/8001196059caaa62a16356d36e355d5d.json"
        }
    </script>
    
<title>Selenium基本操作 - 一博客</title>
<meta name="author" content="Adam" />
<meta name="description" content="随便写了一些Hello World" />
<meta property="og:title" content="Selenium基本操作 - 一博客" />
<meta property="og:description" content="随便写了一些Hello World" />
<meta property="og:site_name" content="一博客" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.imadamtang.cn/archives/Selenium%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2021-06-22T19:05:00+08.00" />
<meta name="twitter:title" content="Selenium基本操作 - 一博客" />
<meta name="twitter:description" content="随便写了一些Hello World" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="https://blog.imadamtang.cn/">一博客</a></h1>
                        <p>巧伪不如拙诚</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="https://blog.imadamtang.cn/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="https://blog.imadamtang.cn/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="https://blog.imadamtang.cn/about/" target="_self">关于</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">Selenium基本操作</h1>
            <span class="ga-post_meta ga-mono">
                <span>Adam</span>
                <time>
                    2021-06-22
                </time>
                
                in <a no-style class="category" href="https://blog.imadamtang.cn/category/%E8%AE%B0%E5%BD%95/">
                    记录
                </a>
                
                
                <span class="leancloud_visitors" 
                    id="/archives/Selenium%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" 
                    data-flag-title="Selenium基本操作"> · <i class="leancloud-visitors-count"></i> Views</span>
                
            </span>
            <div class="ga-content_body">
                <p>随便写了一些</p><h2>Hello World</h2>
<p>环境搭配好之后，写一个简单的程序测试一下</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>         <span class="c1"># 打开Chrome驱动</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://www.baidu.com&#39;</span><span class="p">)</span>     <span class="c1"># 打开百度网页</span>
<span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;kw&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;华为&#39;</span><span class="p">)</span>        <span class="c1"># 通过id定位百度的输入框元素kw，并输入查找的内容</span>
<span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s1">&#39;su&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>                  <span class="c1"># 通过id定位百度的查找按钮，并模拟点击</span>

<span class="c1"># browser.quit()            # 此处为了保留网页，不退出浏览器，其他时候，记得用完退出，避免进程过多</span>
</pre></div>
<h2>Action</h2>
<ul>
<li>打开网页</li>
</ul>
<p>打开页面之后，由于SPES的免密登陆或页面加载，建议采用等待元素的方法，避免网页没加载出来就去定位元素造成报错。等待方法在下面会说。</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://www.baidu.com&#39;</span>			<span class="c1"># 访问的网址</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>					   <span class="c1"># 打开页面</span>
</pre></div>
<ul>
<li>最大化页面</li>
</ul>
<p>浏览器默认打开不是最大化，而有些web系统在小窗口的情况下，元素的位置和加载情况有变化，所以建议直接默认最大化打开</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="o">.</span><span class="n">maximize_window</span><span class="p">()</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://www.baidu.com&#39;</span>			<span class="c1"># 访问的网址</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>					   <span class="c1"># 打开页面</span>
</pre></div>
<ul>
<li>刷新页面</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</pre></div>
<ul>
<li>Frame切换</li>
</ul>
<p>不知道为啥，华为的有些页面很多frame，经常回导致，明明xpath对的，运行的时候却定位异常。这时候，一般都考虑为没有切换到正确的frame上，导致定位出错，切换方法如下：</p><div class="highlight"><pre><span></span>
</pre></div>
<ul>
<li>定位元素</li>
</ul>
<p>核心操作，只要元素定位好了，一起操作都好说，需要灵活运用浏览器的F12开发这么模式。</p><div class="highlight"><pre><span></span><span class="c1"># #######单个元素定位方法，举一些常见例子，推荐使用xpath定位，xpath因为是正则表达式，最灵活#######</span>
<span class="c1"># 通过标签的id属性进行定位，需要注意有些id是动态变化的，该该方法只能定位静态的ID</span>
<span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s2">&quot;table id&quot;</span><span class="p">)</span>

<span class="c1"># 通过正则表达式进行定位，可通过浏览器F12开发者模式对正则表达式进行测试</span>
<span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//div[@ng-bind=&#39;chartModel.title&#39;]&quot;</span><span class="p">)</span>


<span class="c1"># #######多个元素定位#######</span>
<span class="c1"># 加了s，返回的是符合条件的对象集合，通过for循环进行遍历</span>
<span class="n">elems</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_elements_by_id</span><span class="p">(</span><span class="s2">&quot;table ID&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">elems</span><span class="p">:</span>
    <span class="n">i</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>		<span class="c1"># 所有该类元素进行点击操作的举例</span>
</pre></div>
<ul>
<li>等待元素</li>
</ul>
<p>网页加载是需要时间的，有些元素如果在没加载出来之前就进行定位，系统会报<code>NoSuchElementException</code>等异常</p><p>等待分为三类：</p><ol>
<li>强制等待：强制等待多少时间</li>
<li>隐式等待：只需要设置一次，表示查找元素未出现时等待30s，再查没有则抛出异常</li>
<li>显式等待：等待某个元素的加载完成、可点击、内容出现等情况，再去获取元素</li>
</ol>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">ec</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>

<span class="c1"># 强制等待</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>		<span class="c1"># 程序等待5s</span>

<span class="c1"># 隐式等待</span>
<span class="n">browser</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>		<span class="c1"># 隐式等待30s</span>

<span class="c1"># 显示等待</span>
<span class="n">timeout</span> <span class="o">=</span> <span class="mi">10</span>		<span class="c1"># 超时时间</span>
<span class="n">checktime</span> <span class="o">=</span> <span class="mi">1</span>		<span class="c1"># 每1s去去确认一次</span>
<span class="n">xpath</span> <span class="o">=</span> <span class="s1">&#39;//div[@id=&quot;your id&quot;]&#39;</span>			<span class="c1"># xpath定位路径</span>
<span class="c1"># 点击等待</span>
<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">checktime</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)))</span>
<span class="c1"># 加载等待</span>
<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">checktime</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)))</span>
<span class="c1"># 多个元素加载等待</span>
<span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">checktime</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">presence_of_all_elements_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">XPATH</span><span class="p">,</span> <span class="n">xpath</span><span class="p">)))</span>
</pre></div>
<ul>
<li>点击元素</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># 两种方式</span>

<span class="c1"># 直接点击</span>
<span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//div[@ng-bind=&#39;chartModel.title&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

<span class="c1"># 获取元素，在需要的时候点击（如果页面刷新了等情况，点击的元素可能就不存在了，两个操作最好不要离太远）</span>
<span class="n">elem</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//div[@ng-bind=&#39;chartModel.title&#39;]&quot;</span><span class="p">)</span>
<span class="n">elem</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
</pre></div>
<ul>
<li>输入框输入内容</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//div[@ng-bind=&#39;chartModel.title&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">&#39;your content&#39;</span><span class="p">)</span>
</pre></div>
<ul>
<li>元素截图</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//div[@class=&#39;max-chart-area&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="s1">&#39;图片保存路径.png&#39;</span><span class="p">)</span>
</pre></div>
<ul>
<li>获取元素文本</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//div[@ng-bind=&#39;chartModel.title&#39;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</pre></div>
<ul>
<li>js操作</li>
</ul>
<p>js操作适用于有些情况下无法点击或者输入框需要读取value值的情况</p><div class="highlight"><pre><span></span><span class="n">elem</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s2">&quot;//div[@ng-bind=&#39;chartModel.title&#39;]&quot;</span><span class="p">)</span>

<span class="c1"># 点击</span>
<span class="n">browser</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].click();&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
<span class="c1"># 输入</span>
<span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;your input&#39;</span>
<span class="n">browser</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].value=&#39;&quot;</span><span class="o">+</span><span class="n">val</span><span class="o">+</span><span class="s2">&quot;&#39;;&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
</pre></div>
<ul>
<li>无界面登录</li>
</ul>
<p>该方法并非对一切页面适用，有些页面不显示浏览器无法加载元素，请谨慎尝试</p><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">selenium.webdriver.chrome.options</span> <span class="kn">import</span> <span class="n">Options</span>

<span class="n">chrome_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--headless&#39;</span><span class="p">)</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
</pre></div>
<ul>
<li>退出网页</li>
</ul>
<p>操作完王爷后，记得退出浏览器，否则进程不会主动退出，长久会导致内存占用大量<code>chromdriver</code>程序</p><div class="highlight"><pre><span></span><span class="n">browser</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
<h2>References</h2>
<p><a href="https://www.cnblogs.com/malus-fish/p/12441849.html">Selenium元素定位总结</a></p><p><a href="https://blog.csdn.net/WanYu_Lss/article/details/84137519">ElementClickInterceptedException报错的解决</a></p><p><a href="https://blog.csdn.net/weixin_41733260/article/details/88982268">Selenium EC 与 Wait</a></p><p><a href="https://blog.csdn.net/huilan_same/article/details/52541680">Selenium父子、兄弟、相邻节点的定位方式</a></p><p><a href="https://blog.csdn.net/lly1122334/article/details/103504169">Selenium处理反爬虫点击的方式</a></p>
            </div>
        </article>
        <div id="ga-tags">
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <a class="ga-highlight" href="https://blog.imadamtang.cn/archives/%E5%90%B4%E6%81%A9%E8%BE%BE%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">吴恩达机器学习笔记</a>
        <p class="yue">1 概述</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="https://blog.imadamtang.cn/archives/Linux%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/">Linux常用脚本</a>
        <p class="yue">Linux的一些常用脚本和经验#!/bin/sh</p>
    </div>

</section>


    
        <script>
            var initValine = function () {
                new Valine({"enable": true, "el": "#vcomments", "appId": "whpJbIrUvboS1qOUGbAQLYMO-gzGzoHsz", "appKey": "XJmv8dJpt1RJltuKYpw5Io9P", "visitor": true, "recordIP": true});
            }
        </script>
        <script defer src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js' onload="initValine()"></script>
        <div id="vcomments"></div>
    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">一博客</span>
                    </section>
                    <section>
<!--                        <p class="copyright">-->
<!--                            <span>Copyright © 2022 Adam</span>-->
<!--&lt;!&ndash;                            <span>Powered by <a no-style href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Galileo</a></span>&ndash;&gt;-->
<!--                        </p>-->
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="GitHub" href="https://github.com/imadamtang" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2022-02-22T22:22+08:00"
                    </script>
                    <script src="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/galileo-7c8cea54ab.js"></script>
                </footer>
            </div>
        </div>
    </div>

    <!--katex-->
    <script defer src="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    <script src="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/imadamtang/AdamBlog@main/assets/ExSearch/ExSearch-493cb9cd89.js"></script>

    
    </body>
</html>